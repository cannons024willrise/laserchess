<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Laser Chess Nexus</title>
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- Theme Styles -->
  <!-- Classic (Red) Theme -->
  <style id="theme1">
    @font-face { font-family: customfont; src: url(c.otf); }
    html, body { height: 100%; margin: 0; padding: 0; font-family: customfont; background: linear-gradient(#1b0b0b, #3a1b1b); }
    .play-now-btn { position: relative; display: inline-block; padding: 12px 24px; color: #f44336; font-weight: bold; text-transform: uppercase; overflow: hidden; transition: 0.5s; letter-spacing: 4px; background: none; border: none; cursor: pointer; z-index: 1; }
    .play-now-btn:hover { background: #f44336; color: #fff; border-radius: 5px; box-shadow: 0 0 5px #f44336,0 0 25px #f44336,0 0 50px #f44336,0 0 100px #f44336; }
    .play-now-btn span { position: absolute; display: block; background: #f44336; }
    .play-now-btn span:nth-child(1) { top: 0; left: -100%; width: 100%; height: 2px; background: linear-gradient(90deg, transparent, #f44336); animation: btn-anim1 1s linear infinite; }
    .play-now-btn span:nth-child(2) { top: -100%; right: 0; width: 2px; height: 100%; background: linear-gradient(180deg, transparent, #f44336); animation: btn-anim2 1s linear infinite; animation-delay: .25s; }
    .play-now-btn span:nth-child(3) { bottom: 0; right: -100%; width: 100%; height: 2px; background: linear-gradient(270deg, transparent, #f44336); animation: btn-anim3 1s linear infinite; animation-delay: .5s; }
    .play-now-btn span:nth-child(4) { bottom: -100%; left: 0; width: 2px; height: 100%; background: linear-gradient(360deg, transparent, #f44336); animation: btn-anim4 1s linear infinite; animation-delay: .75s; }
    @keyframes btn-anim1 { 0% { left: -100%; } 50%,100% { left: 100%; } }
    @keyframes btn-anim2 { 0% { top: -100%; } 50%,100% { top: 100%; } }
    @keyframes btn-anim3 { 0% { right: -100%; } 50%,100% { right: 100%; } }
    @keyframes btn-anim4 { 0% { bottom: -100%; } 50%,100% { bottom: 100%; } }
  </style>
  <!-- Dark (Blue) Theme -->
  <style id="theme2" disabled>
    @font-face { font-family: customfont; src: url(c.otf); }
    html, body { height: 100%; margin: 0; padding: 0; font-family: customfont; background: linear-gradient(#141e30, #243b55); }
    .play-now-btn { position: relative; display: inline-block; padding: 12px 24px; color: #03e9f4; font-weight: bold; text-transform: uppercase; overflow: hidden; transition: 0.5s; letter-spacing: 4px; background: none; border: none; cursor: pointer; z-index: 1; }
    .play-now-btn:hover { background: #03e9f4; color: #fff; border-radius: 5px; box-shadow: 0 0 5px #03e9f4,0 0 25px #03e9f4,0 0 50px #03e9f4,0 0 100px #03e9f4; }
    .play-now-btn span { position: absolute; display: block; background: #03e9f4; }
    .play-now-btn span:nth-child(1) { top: 0; left: -100%; width: 100%; height: 2px; background: linear-gradient(90deg, transparent, #03e9f4); animation: btn-anim1 1s linear infinite; }
    .play-now-btn span:nth-child(2) { top: -100%; right: 0; width: 2px; height: 100%; background: linear-gradient(180deg, transparent, #03e9f4); animation: btn-anim2 1s linear infinite; animation-delay: .25s; }
    .play-now-btn span:nth-child(3) { bottom: 0; right: -100%; width: 100%; height: 2px; background: linear-gradient(270deg, transparent, #03e9f4); animation: btn-anim3 1s linear infinite; animation-delay: .5s; }
    .play-now-btn span:nth-child(4) { bottom: -100%; left: 0; width: 2px; height: 100%; background: linear-gradient(360deg, transparent, #03e9f4); animation: btn-anim4 1s linear infinite; animation-delay: .75s; }
    @keyframes btn-anim1 { 0% { left: -100%; } 50%,100% { left: 100%; } }
    @keyframes btn-anim2 { 0% { top: -100%; } 50%,100% { top: 100%; } }
    @keyframes btn-anim3 { 0% { right: -100%; } 50%,100% { right: 100%; } }
    @keyframes btn-anim4 { 0% { bottom: -100%; } 50%,100% { bottom: 100%; } }
  </style>
</head>
<body class="min-h-screen text-gray-900" onload="bgc()">
  <!-- Header -->
  <header class="flex justify-between items-center p-4 bg-white shadow">
    <div class="flex items-center space-x-4">
      <h1 class="text-2xl font-bold">Laser Chess Nexus</h1>
    </div>
    <div>
      <a href="#" class="text-indigo-600" id="userEmail">Account</a>
      <a href="#" class="text-red-500" onclick="handleSignOut()">Sign out</a>
    </div>
  </header>

  <!-- Discord Community Link -->
  <section class="p-4 bg-indigo-600 text-white text-center">
    <a href="https://discord.gg/XWzetZEM" class="font-semibold">Join Our Discord Community</a>
  </section>

  <!-- Greeting Section -->
  <section class="flex flex-col items-center justify-center py-20 space-y-6">
    <h1 class="text-5xl font-bold text-white">Ready for your next battle, Strategist?</h1>
    <!-- Side Selector -->
    <div class="flex items-center space-x-4">
      <span class="text-gray-200 font-medium">Red</span>
      <label class="relative inline-flex items-center cursor-pointer">
        <input id="sideToggle" type="checkbox" class="sr-only peer" />
        <div class="w-12 h-6 bg-red-500 rounded-full peer-checked:bg-blue-500 transition"></div>
        <span class="absolute left-1 top-1 bg-white w-4 h-4 rounded-full peer-checked:translate-x-6 transition"></span>
      </div>
      <span class="text-gray-200 font-medium">Blue</span>
    </section>

  <!-- Footer -->
  <footer class="p-4 text-center text-gray-400">
    This is the Alpha version of the game. <br />
    If you find any problems, please contact me at:
    <a href="mailto:later5143@gmail.com" class="text-indigo-600 hover:underline">
      later5143@gmail.com
    </a>
  </footer>

  <script src="https://cdn.jsdelivr.net/npm/firebase@9.23.0/firebase-app.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/firebase@9.23.0/firebase-analytics.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/firebase@9.23.0/firebase-auth.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/firebase@9.23.0/firebase-database.js"></script>

  <script type="module">
  // Import necessary Firebase modules
  import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
  import { getAnalytics } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-analytics.js";
  import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-auth.js";
  import { getDatabase, ref, onValue } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-database.js";

  // Initialize Firebase
  const firebaseConfig = {
    apiKey: "AIzaSyAj4N3x89n7tbHHQfRi5kyeM5F8yQCocGQ",
    authDomain: "khet-c6b0f.firebaseapp.com",
    databaseURL: "https://khet-c6b0f-default-rtdb.europe-west1.firebasedatabase.app",
    projectId: "khet-c6b0f",
    storageBucket: "khet-c6b0f.firebasedorage.app",
    messagingSenderId: "866179433994",
    appId: "1:866179433994:web:a9162c242fbc24dd7e41f3",
    measurementId: "G-T4246JW0MH"
  };
  const app = initializeApp(firebaseConfig);
  getAnalytics(app);
  const auth = getAuth();
  const db = getDatabase();

  // Protect page & show email
  onAuthStateChanged(auth, user => {
    if (!user) {
      window.location.replace("https://laserchess.pages.dev/Auth/login");
    } else {
      document.getElementById("userEmail").textContent = user.email;
    }
  });

  // Sign-out helper
  window.handleSignOut = () => {
    signOut(auth).then(() => {
      window.location.replace("https://laserchess.pages.dev/Auth/login");
    }).catch(console.error);
  };

  // Play Now / Match Request
  document.getElementById("playBtn").addEventListener("click", async () => {
    const user = auth.currentUser;
    if (!user) { alert("Please sign in first."); return; }
    const side = document.getElementById("sideToggle").checked ? "blue" : "red";
    let idToken;
    try {
      idToken = await user.getIdToken(true);
    } catch (e) {
      alert("Auth error, please try again."); return;
    }
    try {
      const res = await fetch(
        "https://laserchessnexus-matchmanager-v-alpha.later5143.workers.dev",
        { method: "POST", headers: { "Content-Type": "application/json", "Authorization": `Bearer ${idToken}` }, body: JSON.stringify({ side }) }
      );
      const data = await res.json();
      if (!res.ok) throw new Error(data.error || JSON.stringify(data));
      console.log("✅ Match request added:", data);
      document.getElementById("playBtn").textContent = "Waiting…";
    } catch (err) {
      alert(`Error: ${err.message}`);
    }
  });

  // Real-time Lobby Table
  const requestsDiv = document.getElementById("requests");
  const table = document.createElement("table");
  table.className = "min-w-full bg-white text-gray-900 rounded shadow";
  requestsDiv.innerHTML = "<h3 class='text-2xl font-bold text-white mb-4'>Lobby</h3>";
  requestsDiv.appendChild(table);
  onValue(ref(db, "Lobby"), snapshot => {
    const records = snapshot.val() || {};
    table.innerHTML = `
      <thead class="bg-gray-200">
        <tr><th class="px-4 py-2">Email</th><th class="px-4 py-2">Side</th><th class="px-4 py-2">Time</th></tr>
      </thead><tbody></tbody>
    `;
    const tbody = table.querySelector("tbody");
    Object.entries(records).forEach(([key, rec]) => {
      const tr = document.createElement("tr");
      tr.innerHTML = `
        <td class="border px-4 py-2">${key.replace(/,/g, ".")}</td>
        <td class="border px-4 py-2">${rec.side ? "blue" : "red"}</td>
        <td class="border px-4 py-2">${new Date(rec.time || rec.timestamp).toLocaleTimeString()}</td>
      `;
      tbody.appendChild(tr);
    });
  });

  // Theme Switcher
  const t1 = document.getElementById("theme1"), t2 = document.getElementById("theme2"), tog = document.getElementById("sideToggle");
  window.addEventListener("DOMContentLoaded", () => { const pick = Math.random()<0.5; t1.disabled = !pick; t2.disabled = pick; tog.checked = pick; });
  tog.addEventListener("change", () => { t1.disabled = tog.checked; t2.disabled = !tog.checked; });
  function bgc(){ t1.disabled = !tog.checked; t2.disabled = tog.checked; }
</script>
</body>
</html>
