<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Laser Chess Nexus</title>
  <script src="https://cdn.tailwindcss.com"></script>
<!-- Firebase App (required) -->
<script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>

<!-- Firebase Auth -->
<script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-auth-compat.js"></script>
<link id="themeRed" rel="stylesheet" href="red.css" disabled>
<link id="themeBlue" rel="stylesheet" href="blue.css" disabled>
<script src="theme-switch.js"></script>
<script src="homeauthcheck.js"></script>
</head>














  
<body class="min-h-screen text-gray-900" onload="bgc()">
  <!-- Header -->
  <header class="flex justify-between items-center p-4 bg-white shadow">
    <div class="flex items-center space-x-4">
      <h1 class="text-2xl font-bold">Laser Chess Nexus</h1>
    </div>
    <div>
      <a href="#" class="text-indigo-600" id="userEmail">Account</a>
      <a href="#" class="text-red-500" onclick="handleSignOut()">Sign out</a>
    </div>
  </header>

  <!-- Discord Community Link -->
  <section class="p-4 bg-indigo-600 text-white text-center">
    <a href="https://discord.gg/XWzetZEM" class="font-semibold">Join Our Discord Community</a>
  </section>

  <!-- Greeting Section -->
  <section class="flex flex-col items-center justify-center py-20 space-y-6">
    <h1 class="text-5xl font-bold text-white">Ready for your next battle, Strategist?</h1>
    <!-- Side Selector -->
    <div class="flex items-center space-x-4">
      <span class="text-gray-200 font-medium">Red</span>
      <label class="relative inline-flex items-center cursor-pointer">
        <input id="sideToggle" type="checkbox" class="sr-only peer" />
        <div class="w-12 h-6 bg-red-500 rounded-full peer-checked:bg-blue-500 transition"></div>
        <span class="absolute left-1 top-1 bg-white w-4 h-4 rounded-full peer-checked:translate-x-6 transition"></span>
      </label>
      <span class="text-gray-200 font-medium">Blue</span>
    </div>
<div id="requests" class="flex flex-col items-center justify-center py-20 space-y-6">
  <br>
  <center>
 <div class="w-full max-w-3xl mx-auto px-4">
  <h3 class="text-2xl font-bold text-white text-center mb-4">CHOOSE YOUR OPPONENT.</h3>

  <div class="overflow-x-auto bg-transparent rounded-lg">
    <table id="lobby-table" class="min-w-full table-auto text-left">
      <thead>
        <tr>
          <th class="px-4 py-2 text-sm font-medium text-gray-200">Opponent UUID</th>
          <th class="px-4 py-2 text-sm font-medium text-gray-200">Side You Must Play</th>
        </tr>
      </thead>
      <tbody id="lobby-body">
        <!-- JS will inject rows here -->
        <tr id="lobby-empty-row">
          <td class="px-4 py-3 text-gray-300" colspan="2">No matches in the lobby.</td>
        </tr>
      </tbody>
    </table>
  </div>
</div>

  </center>
</div>
    <!-- Play Button with Animated Borders -->
    <button class="play-now-btn">
      <span></span><span></span><span></span><span></span>
      Play Now/Update Lobby
    </button>
  </section>

  <!-- Footer -->
  <footer class="p-4 text-center text-gray-400">
    This is the Alpha version of the game. <br />
    If you find any problems, please contact me at:
    <a href="mailto:later5143@gmail.com" class="text-indigo-600 hover:underline">
      later5143@gmail.com
    </a>
  </footer>
  <script src="https://challenges.cloudflare.com/turnstile/v0/api.js" async defer></script>

  <form id="my-form">
    <div class="cf-turnstile" data-sitekey="0x4AAAAAABdKR0oWMX67xVHO"></div>
    <button type="submit">Submit</button>
  </form>
  
<!-- Scripts -->

  <script>
 // 6) Play Now handler
    document.addEventListener("DOMContentLoaded", () => {
      const toggle  = document.getElementById("sideToggle");
      const playBtn = document.querySelector(".play-now-btn");

      playBtn.addEventListener("click", async () => {
        // ensure user is signed in
        const user = auth.currentUser;
        if (!user) {
          return alert("Please sign in first.");
        }

        // determine side
        const side = toggle.checked ? "blue" : "red";

        // get fresh ID token
        let idToken;
        try {
          idToken = await user.getIdToken(true);
        } catch (e) {
          console.error("Token error:", e);
          return alert("Auth error, please try again.");
        }

        // call your Cloudflare Worker
        try {
          const res = await fetch(
            "https://laserchessnexus-matchmanager-v-alpha.later5143.workers.dev",
            {
              method: "POST",
              headers: {
                "Content-Type":  "application/json",
                "Authorization": `Bearer ${idToken}`
              },
              body: JSON.stringify({ side })
            }
          );
          if (!res.ok) {
            const text = await res.text();
            throw new Error(text || res.status);
          }
          const data = await res.json();
          console.log("Matchmaker →", data);
          // TODO: navigate to your match page or show matchId, etc.
        } catch (err) {
          console.error("Queue error:", err);
          alert("Failed to join queue—check console for details.");
        }
      });
    });
});



   
  </script>

 
</body>
</html>
